<section id="account_section">
  <%= render "shared/sidebar" %>
  <div id="support" class="main_side">
    <div id="top_header">
      <h1>Support</h1>
      <%= render "shared/header-side" %>
    </div>
    <div class="row">
      <div class="col-4" style="width: 32rem;">
        <ul class="tabs nav scrollbar">
          <li>
            <a href="#end_users" data-bs-toggle="tab" class="active">
              End Users
            </a>
          </li>
          <li>
            <a href="#support_closers" data-bs-toggle="tab">
              Support Closers
            </a>
          </li>
        </ul>
        <div class="tab-content">
        <div id="end_users" class="tab-pane fade show active">
          <ul class="chats active">
            <% @end_users.each_with_index do |record,index| %>
              <li>
              <div class="chat_blk <%= index == 0 ? 'active-bg' : "" %>">
                <div class="chat_blk_left">
                  <div class="profile_blk">
                    <img src="./assets/images/chatProfile.svg" alt="">
                  </div>
                  <div class="profile_name">
                    <p><%= record.sender.full_name %></p>
                    <span><%= record.user_support_messages.last&.body %></span>
                  </div>
                </div>
                <div class="time">
                  <p><%= record.created_at.strftime("%H:%M") %></p>
                  <div class="message_count">3</div>
                  <div class="online"></div>
                </div>
              </div>
            </li>
            <%end%>
          </ul>
        </div>
        <div id="support_closers" class="tab-pane fade ">
          <ul class=" chats">
            <% @support_closers.each do |record| %>
              <li>
              <div class="chat_blk">
                <div class="chat_blk_left">
                  <div class="profile_blk">
                    <img src="./assets/images/chatProfile.svg" alt="">
                  </div>
                  <div class="profile_name">
                    <p><%= record.sender.full_name %></p>
                    <span><%= record.user_support_messages.last&.body %></span>
                  </div>
                </div>
                <div class="time">
                  <p><%= record.created_at.strftime("%H:%M") %></p>
                  <div class="message_count">3</div>
                  <div class="online"></div>
                </div>
              </div>
            </li>
            <%end%>
          </ul>
        </div>
        </div>
      </div>
      <div class="col-8">
        <div class="chat_sec">
          <div class="top_blk">
            <div class="tag chat_box<%= @message.id %> " data-id="<%= @message.id %>" id="chatmessagebox">
              <%= @message.support.ticket_number %>
            </div>
            <div class="dropdown">
              <button class="select dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                Mark as
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </div>
          </div>
          <div class="chat_msg">
            <% last_index = '' %>
            <%@message.support_messages.each do |record| %>
              <% if last_index != record.created_at.strftime("%D")%>
                <div class="mt-5 d-flex chat_date">
                  <span><%= record.created_at.strftime("%d %B %Y") %></span>
                </div>
                <% last_index = record.created_at.strftime("%D") %>
              <%end%>
              <% unless record.type == "AdminSupportMessage" %>
                <div class="support_msg">
                  <div class="d-flex flex-column">
                    <div class="msg">
                      <p><%= record.body %></p>
                    </div>
                    <p class="msg_time mt-2"><%= time_ago_in_words(record.created_at) %></p>
                  </div>

                  <div class="profile_pic">
                    <div class="img_blk">

                      <%#= image_tag record&.user&.avatar&.url , alt: "" %>
                    </div>
                  </div>
                </div>
              <%else%>
                 <div class="user_msg">
                    <div class="profile_pic">
                      <div class="img_blk">
                        <img src="./assets/images/chatProfile.svg" alt="">
                      </div>
                    </div>
                    <div class="d-flex flex-column">
                      <div class="msg">
                        <p><%= record.body %></p>
                      </div>
                      <p class="msg_time mt-2"> <%= time_ago_in_words(record.created_at) %></p>
                    </div>
                </div>
              <%end%>
            <%end%>
          </div>

        </div>
          <hr>
        <div class="msg_blk">
          <%= form_tag({:controller => 'supports', :action => 'create'},:id => 'filter_form', :remote => true) do %>
            <%= hidden_field_tag :id ,@message.id %>
            <div class="msg_type">
              <div class="icon_blk">
                <%= image_tag "attactFile.svg" ,alt: "attachFile",id: "clickaddfile"%>
                <input type="file" name="file" id="submitaddfile" hidden accept="application/pdf,application/vnd.ms-excel">
              </div>
              <div class="icon_blk">
                <%= image_tag "emoji.svg" ,alt: "icons"%>
              </div>
              <div class="icon_blk">
                <%= image_tag "addphoto.svg" ,alt: "Photo",id: "clickaddphoto"%>
                <input type="file" name="image" id="submitaddphoto" hidden accept="image/*" multiple>
              </div>
              <div class="form_blk w-100">
                <%= text_field_tag :text, nil, class: 'input',id: "typemessage", placeholder: "Write your message here" %>
              </div>
            </div>
            <button type="submit">
              <%= image_tag "sendMessage.svg", alt: "send message" %>
            </button>
          <%end%>
        </div>
      </div>
    </div>
  </div>
</section>